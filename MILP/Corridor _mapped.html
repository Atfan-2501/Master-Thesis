<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Intermodal Corridors in Switzerland</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet.js for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        /* Set a specific height for the map container */
        #map { 
            height: 800px; 
            border-radius: 0.5rem; /* Match card rounding */
        }
        /* Custom Leaflet popup styles for better readability */
        .leaflet-popup-content-wrapper {
            background-color: #f9fafb; /* Light gray background */
            color: #1f2937; /* Darker text */
            border-radius: 8px;
        }
        .leaflet-popup-content {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        /* Custom styles for the legend */
        .legend {
            padding: 10px;
            background: white;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
            line-height: 18px;
            color: #333;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.8;
            border-radius: 50%; /* Make icons circular */
        }
        .legend-corridor {
            width: 18px;
            height: 3px;
            float: left;
            margin-right: 8px;
            opacity: 0.8;
        }
    </style>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans flex items-center justify-center min-h-screen p-4" style="font-family: 'Inter', sans-serif;">

    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-5xl">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Key Short-Distance Intermodal Corridors in Switzerland</h1>
            <p class="text-gray-600 mt-2">
                Visualization of the terminals and short-distance intermodal freight corridors (&lt; 300 km)
                that form the basis of the MILP model.
            </p>
        </div>
        <!-- Map container -->
        <div id="map" class="shadow-inner"></div>
    </div>

    <script>
        // --- 0. Terminal data (from terminals.csv, converted from LV95 to WGS84) ---
        // short_name matches your CSV, name is the nice label, lat/lon are in degrees.
        const terminals = [
            { short_name: "AARA", name: "Aarau",        lat: 47.385265, lon: 7.837830 },
            { short_name: "STAB", name: "Stabio",       lat: 45.442638, lon: 8.984789 },
            { short_name: "VISP", name: "Visp",         lat: 46.452842, lon: 7.710949 },
            { short_name: "BASE", name: "Basel",        lat: 47.497478, lon: 7.444993 },
            { short_name: "BERN", name: "Bern",         lat: 46.951083, lon: 7.438632 },
            { short_name: "LUZE", name: "Luzern",       lat: 47.043854, lon: 8.280169 },
            { short_name: "LAUS", name: "Lausanne",     lat: 46.521472, lon: 6.567939 },
            { short_name: "OLTE", name: "Olten",        lat: 47.130306, lon: 7.834034 },
            { short_name: "SCHA", name: "Schaffhausen", lat: 47.665125, lon: 8.570281 },
            { short_name: "WINT", name: "Winterthur",   lat: 47.430371, lon: 8.658082 },
        ];

        // Build quick lookup by short_name for corridor construction
        const terminalIndex = {};
        terminals.forEach(t => { terminalIndex[t.short_name] = t; });

        // --- 1. Initialize the Map ---
        // Center the map roughly on Switzerland
        const map = L.map('map').setView([46.8, 8.2], 8);

        // Add the base tile layer from OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // --- 2. (Optional) Macro economic regions as soft background polygons ---
        // You can keep/remove these if you want only the terminals.
        const zurichRegion = L.polygon([
            [47.2, 8.3],
            [47.5, 8.2],
            [47.6, 8.9],
            [47.2, 8.8]
        ], {color: '#3b82f6', weight: 1.5, fillOpacity: 0.15}).addTo(map);
        zurichRegion.bindPopup("<b>Zurich Economic Region</b><br>High-density logistics and industrial demand.");

        const genevaRegion = L.polygon([
            [46.1, 5.9],
            [46.6, 6.0],
            [46.6, 6.9],
            [46.1, 6.8]
        ], {color: '#16a34a', weight: 1.5, fillOpacity: 0.15}).addTo(map);
        genevaRegion.bindPopup("<b>Lake Geneva Region</b><br>Western gateway for international trade flows.");

        const baselRegion = L.polygon([
            [47.4, 7.4],
            [47.7, 7.4],
            [47.7, 7.8],
            [47.4, 7.8]
        ], {color: '#ef4444', weight: 1.5, fillOpacity: 0.15}).addTo(map);
        baselRegion.bindPopup("<b>Basel Trimodal Hub</b><br>Rail–road–water interface on the Rhine.");

        // --- 3. Plot your terminals as nodes ---
        terminals.forEach(t => {
            const marker = L.circleMarker([t.lat, t.lon], {
                radius: 7,
                color: '#111827',      // stroke
                weight: 1.2,
                fillColor: '#f97316',  // orange-ish fill
                fillOpacity: 0.9
            }).addTo(map);

            marker.bindPopup(
                `<b>${t.name}</b> (${t.name})<br>` +
                `Intermodal terminal used in the MILP network.`
            );

            // Label next to the node
            const labelOffsetLat = 0.03;   // tweak if labels overlap
            const labelOffsetLon = 0.06;
            L.tooltip({
                permanent: true,
                direction: 'right',
                offset: [4, 0],
                className: 'terminal-label'
            })
            .setContent(t.name)
            .setLatLng([t.lat + 0.01, t.lon + 0.01])
            .addTo(map);
        });

        // --- 4. Define freight corridors between your nodes ---
        // Each corridor is a sequence of terminal short_names.
        // Adjust these paths to reflect your actual modeled corridors.
        const corridors = [
            // Western arc: Basel – Olten – Aarau – Bern – Lausanne
            ["BASE", "OLTE", "AARA", "BERN", "LAUS"],
            // Central / eastern arc: Basel – Olten – Luzern – Winterthur – Schaffhausen
            ["BASE", "OLTE", "LUZE", "WINT", "SCHA"],
            // South link: Luzern – Visp – Stabio (stylized north–south freight arc)
            ["LUZE", "VISP", "STAB"]
        ];

        corridors.forEach(pathIds => {
            // Map short_names to lat/lon
            const coords = pathIds
                .filter(id => terminalIndex[id])  // safety check
                .map(id => [terminalIndex[id].lat, terminalIndex[id].lon]);

            if (coords.length >= 2) {
                const polyline = L.polyline(coords, {
                    color: '#7c3aed',
                    weight: 4,
                    opacity: 0.85,
                    dashArray: '8, 8'
                }).addTo(map);

                polyline.bindPopup(
                    "<b>Modeled Intermodal Corridor</b><br>" +
                    pathIds.join(" \u2192 ") + " (stylized)."
                );
            }
        });

        // --- 5. Add a Legend ---
        const legend = L.control({position: 'bottomright'});

        legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'legend');
            
            // Terminals
            div.innerHTML = '<h4>Legend</h4>';
            div.innerHTML +=
                '<i style="background:#f97316; border:1px solid #111827;"></i> ' +
                'Intermodal terminals<br>';

            // Regions
            div.innerHTML += '<hr class="my-2 border-gray-300">';
            div.innerHTML += '<b>Macro Regions</b><br>';
            div.innerHTML += '<i style="background:#3b82f6;"></i> Zurich Region<br>';
            div.innerHTML += '<i style="background:#16a34a;"></i> Lake Geneva Region<br>';
            div.innerHTML += '<i style="background:#ef4444;"></i> Basel Region<br>';

            // Corridors
            div.innerHTML += '<hr class="my-2 border-gray-300">';
            div.innerHTML += '<b>Corridors</b><br>';
            div.innerHTML += '<span class="legend-corridor" style="background:#7c3aed;"></span> Short-distance intermodal corridors';

            return div;
        };

        legend.addTo(map);
    </script>
</body>
</html>
